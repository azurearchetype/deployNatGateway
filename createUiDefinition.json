{
    "$schema"; "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler"; "Microsoft.Azure.CreateUIDef",
    "version"; "0.1.2-preview",
    "parameters"; {
        "basics"; [],
        "steps"; [
            {
                "name": "networkConfig",
                "label": "Network Configuration",
                "subLabel": {
                    "preValidation": "Configure the virtual network and subnets",
                    "postValidation": "Done"
                },
                "bladeTitle": "Network Configuration",
                "elements": [
                    {
                        "name": "vnetSelection",
                        "type": "Microsoft.Network.VirtualNetworkCombo",
                        "label": {
                            "virtualNetwork": "Virtual Network",
                            "subnets": "Subnets"
                        },
                        "toolTip": {
                            "virtualNetwork": "Select an existing virtual network for the NAT Gateway.",
                            "subnets": "Select one or more subnets to associate with the NAT Gateway."
                        },
                        "defaultValue": {
                            "name": "",
                            "addressPrefixSize": "/16"
                        },
                        "constraints": {
                            "minAddressPrefixSize": "/29",
                            "requireSubnets": false
                        },
                        "options": {
                            "hideExisting": false,
                            "hideNew": true
                        }
                    },
                    {
                        "name": "subnetSelectionSection",
                        "type": "Microsoft.Common.Section",
                        "label": "Subnet Selection",
                        "visible": "[and(not(empty(steps('networkConfig').vnetSelection.name)), greater(length(steps('networkConfig').vnetSelection.subnets), 0))]",
                        "elements": [
                            {
                                "name": "subnetInfo",
                                "type": "Microsoft.Common.InfoBox",
                                "options": {
                                    "icon": "Info",
                                    "text": "Select the subnets from the chosen virtual network that you want to associate with the NAT Gateway."
                                }
                            },
                            {
                                "name": "selectedSubnets",
                                "type": "Microsoft.Common.EditableGrid",
                                "ariaLabel": "Subnet selection",
                                "label": "Available Subnets",
                                "constraints": {
                                    "width": "Full",
                                    "rows": {
                                        "count": {
                                            "min": 1,
                                            "max": 10
                                        }
                                    },
                                    "columns": [
                                        {
                                            "id": "select",
                                            "header": "Select",
                                            "width": "1fr",
                                            "element": {
                                                "type": "Microsoft.Common.CheckBox",
                                                "label": "Select this subnet"
                                            }
                                        },
                                        {
                                            "id": "subnetName",
                                            "header": "Subnet Name",
                                            "width": "2fr",
                                            "element": {
                                                "type": "Microsoft.Common.TextBox",
                                                "placeholder": "Subnet name",
                                                "constraints": {
                                                    "required": false,
                                                    "regex": "",
                                                    "validationMessage": ""
                                                }
                                            }
                                        },
                                        {
                                            "id": "addressPrefix",
                                            "header": "Address Prefix",
                                            "width": "2fr",
                                            "element": {
                                                "type": "Microsoft.Common.TextBox",
                                                "placeholder": "e.g., 10.0.1.0/24",
                                                "constraints": {
                                                    "required": false,
                                                    "regex": "",
                                                    "validationMessage": ""
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                ]
            }
        ],
        "outputs"; {
            "location"; "[location()]",
            "vnetName"; "[steps('networkConfig').vnetSelection.name]",
            "vnetResourceGroup"; "[steps('networkConfig').vnetSelection.resourceGroup]",
            "selectedSubnets"; "[steps('networkConfig').subnetSelectionSection.selectedSubnets]"
        }
    }
}
